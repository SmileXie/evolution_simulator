<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Evolotion Simulater</title>
<script src="matter.js"></script>
</head>
<body>
<div id="c"></div>
<script>
// module aliases
var Engine = Matter.Engine,
    Render = Matter.Render,
    Runner = Matter.Runner,
    Bodies = Matter.Bodies,
    Composite = Matter.Composite;

var canvas_width = 1200;
var canvas_height = 600;

// create an engine
var engine = Engine.create();

// create a renderer
let render = Render.create({
    element: document.getElementById('c'),
    engine: engine,
    options: {
        width: canvas_width,
        height: canvas_height,
        wireframes: false
    }
});

// create two boxes and a ground
var individual1 = Bodies.circle(100, -200, 50);
individual1.restitution = 0.9;

function sfc32(a, b, c, d) {
  return function() {
    a |= 0; b |= 0; c |= 0; d |= 0;
    let t = (a + b | 0) + d | 0;
    d = d + 1 | 0;
    a = b ^ b >>> 9;
    b = c + (c << 3) | 0;
    c = (c << 21 | c >>> 11);
    c = c + t | 0;
    return (t >>> 0) / 4294967296;
  }
}

var seed = 1077 ^ 0xDEADBEEF; // 32-bit seed with optional XOR value
// Pad seed with Phi, Pi and E.
// https://en.wikipedia.org/wiki/Nothing-up-my-sleeve_number
// seedable random number generator: https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript
var rand = sfc32(0x9E3779B9, 0x243F6A88, 0xB7E15162, seed);

function getRandomInt(min, max) {
    return Math.floor(rand() * (max - min + 1)) + min;
}

function getRandomFloat(min, max) {
    return rand() * (max - min) + min;
}

function generateRandomRocks(count) {
    const rocks = [];
    for (let i = 0; i < count; i++) {
        const x = getRandomFloat(canvas_width/count*i, canvas_width/count*(i + 1));
        const y = getRandomFloat(canvas_height/count*i, canvas_height/count*(i + 1));
        const radius = getRandomFloat(30, 100); // 随机半径或边长
        const sides = getRandomInt(3, 10); // 随机边数

        const rock = Bodies.polygon(x, y, sides, radius, { isStatic: true });
        rocks.push(rock);
    }
    return rocks;
}

// 生成19个随机岩石
const mountain = generateRandomRocks(19);
mountain.forEach(function(rock) {
    rock.restitution = 0.9;
});

mountain_com = Composite.create({bodies: mountain});
// add all of the bodies to the world
Composite.add(engine.world, individual1);
Composite.add(engine.world, mountain_com);

// run the renderer
Render.run(render);

// create runner
var runner = Runner.create();

// run the engine
Runner.run(runner, engine);
</script>
</body>
</html>
